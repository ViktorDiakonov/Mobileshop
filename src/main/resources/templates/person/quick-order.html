<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</title>
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div th:replace="~{fragments/brand-sidebar :: brand-sidebar}"></div>

<nav style="margin-left: 50px;">
    <a href="/mobileshop/" style="color: black; text-decoration: none;"> <span><i class="fas fa-home home-icon"></i> –ì–æ–ª–æ–≤–Ω–∞</span></a>
    <span style="color: gray;"> &gt; </span>
    <a th:href="@{/mobileshop/phones/{id}(id=${phone.getBrand().toLowerCase()})}"
       style="color: black; text-decoration: none; font-family: Grava Display, serif">
        –°–º–∞—Ä—Ç—Ñ–æ–Ω–∏ <span th:text="${phone.getBrand()}"></span>
    </a>
    <span style="color: gray;"> &gt; </span>
    <span th:text="${phone.getModel()}"
          style="font-weight: bold; color: black; font-family: Grava Display, serif;"></span>
</nav>

<div class="order-container" style="margin-top: 50px">
    <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
    <br>
    <!--    <form method="POST" th:action="@{/mobileshop/{id}/quick-order-confirmation(id=${phone.getId()})}" th:object="${phone}">-->
    <!--    <form th:object="${order}" method="POST"-->
    <!--          th:action="@{/mobileshop/{id}/quick-order-confirmation(id=${phone.id})}">-->
    <!--        <div class="phone-details">-->
    <!--            <img id="phoneImage" th:src="${phone.imagePath}" alt="–§–æ—Ç–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É">-->
    <!--            <div class="phone-info">-->
    <!--                <p><strong>–í–∏—Ä–æ–±–Ω–∏–∫:</strong> <span th:text="${phone.brand}"></span></p>-->
    <!--                <p><strong>–ú–æ–¥–µ–ª—å:</strong> <span th:text="${phone.model}"></span></p>-->
    <!--                <p><strong>–í–±—É–¥–æ–≤–∞–Ω–∞ –ø–∞–º'—è—Ç—å:</strong> <span th:text="${phone.memorySize}"></span> –ì–ë</p>-->
    <!--                <br>-->
    <!--                <p><strong>–¶—ñ–Ω–∞:</strong> <span id="priceDisplay"-->
    <!--                                                th:text="${#numbers.formatInteger(phone.price, 0, 'DEFAULT')}"></span> ‚Ç¥-->
    <!--                    <input type="number" id="quantity" name="quantity" min="1" max="100" value="1" required>-->
    <!--                    <label for="quantity">—à—Ç.</label>-->
    <!--                </p>-->
    <!--                <p><strong>–°—É–º–∞ –¥–æ —Å–ø–ª–∞—Ç–∏:</strong> <span id="totalPrice">0</span> ‚Ç¥</p>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--        <hr style="width: 80%; margin: 0 auto; border: 1px solid grey;"/>-->
    <!--        <br>-->
    <!--        <div style="display: flex; flex-direction: column; align-items: flex-end; margin-right: 80px">-->
    <!--            <p style="margin: 5px;">-->
    <!--                <label for="personName">–Ü–º'—è –ø–æ–∫—É–ø—Ü—è:</label>-->
    <!--                <input style="border: 2px solid limegreen; border-radius: 5px; padding: 8px;" type="text"-->
    <!--                       id="personName" name="personName" placeholder="–≤i–¥ 2 –¥–æ 20 –ª—ñ—Ç–µ—Ä" required minlength="2"-->
    <!--                       maxlength="20">-->
    <!--            </p>-->
    <!--            <p style="margin: 5px;">-->
    <!--                <label for="personPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:</label>-->
    <!--                <input style="border: 2px solid limegreen; border-radius: 5px; padding: 8px;" type="tel"-->
    <!--                       id="personPhone" name="personPhone" pattern="380\d{9}" placeholder="380XXXXXXXXX"-->
    <!--                       required value="380">-->
    <!--            </p>-->
    <!--        </div>-->
    <!--        <div style="display: flex; margin-top: 7px; justify-content: flex-end;">-->
    <!--            <label for="personComment"></label><br>-->
    <!--            <div style="display: flex; align-items: flex-end; gap: 18px;">-->
    <!--                <div id="charCount" style="font-size: 14px; color: #777; white-space: nowrap;">0/150</div>-->
    <!--                <textarea id="personComment" name="personComment" placeholder="–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä:" minlength="0"-->
    <!--                          maxlength="150" rows="3" cols="50" oninput="updateCharacterCount()"-->
    <!--                          style="text-align: left; vertical-align: top; resize: none; width: 70%; padding: 8px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc;"></textarea>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--        <script>-->
    <!--            function updateCharacterCount() {-->
    <!--                let textArea = document.getElementById('personComment');-->
    <!--                let charCount = textArea.value.length;-->
    <!--                let maxLength = textArea.getAttribute('maxlength');-->
    <!--                document.getElementById('charCount').textContent = charCount + '/' + maxLength;-->
    <!--            }-->
    <!--        </script>-->

    <!--        <script>-->
    <!--            const phoneInput = document.getElementById('personPhone');-->

    <!--            phoneInput.addEventListener('input', function () {-->
    <!--                if (!phoneInput.value.startsWith('380')) {-->
    <!--                    phoneInput.value = '380';-->
    <!--                }-->
    <!--            });-->
    <!--        </script>-->
    <!--        <br>-->
    <!--        <p>-->
    <!--            <label for="pickupPoint">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–æ—á–∫—É –≤–∏–¥–∞—á—ñ:</label>-->
    <!--            <select id="pickupPoint" name="point" required>-->
    <!--                <option value="–ö–∏—ó–≤, –≤—É–ª. –ê–Ω—Ç–æ–Ω–æ–≤–∏—á–∞, 50">–ö–∏—ó–≤, –≤—É–ª. –ê–Ω—Ç–æ–Ω–æ–≤–∏—á–∞, 50 (10:00-21:00)</option>-->
    <!--                <option value="–î–Ω—ñ–ø—Ä–æ, –≤—É–ª. –ú–∞–≥–Ω—ñ—Ç–æ–≥–æ—Ä—Å—å–∫–∞, 1–ê">–î–Ω—ñ–ø—Ä–æ, –≤—É–ª. –ú–∞–≥–Ω—ñ—Ç–æ–≥–æ—Ä—Å—å–∫–∞, 1–ê (10:00-21:00)</option>-->
    <!--                <option value="–û–¥–µ—Å–∞, –≤—É–ª. –î–µ—Ä–∏–±–∞—Å—ñ–≤—Å—å–∫–∞ 3–î">–û–¥–µ—Å–∞, –≤—É–ª. –î–µ—Ä–∏–±–∞—Å—ñ–≤—Å—å–∫–∞ 3–î (09:00-22:00)</option>-->
    <!--            </select>-->
    <!--        </p>-->
    <!--        <div class="form-group">-->
    <!--            <button type="submit" class="btn-submit">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>-->
    <!--        </div>-->
    <!--    </form>-->
    <form method="POST" th:action="@{/mobileshop/{id}/quick-order-confirmation(id=${phone.id})}"
          th:object="${order}" novalidate>
        <div class="phone-details">
            <img id="phoneImage" th:src="${phone.imagePath}" alt="–§–æ—Ç–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É">
            <div class="phone-info">
                <p><strong>–í–∏—Ä–æ–±–Ω–∏–∫:</strong> <span th:text="${phone.brand}"></span></p>
                <p><strong>–ú–æ–¥–µ–ª—å:</strong> <span th:text="${phone.model}"></span></p>
                <p><strong>–í–±—É–¥–æ–≤–∞–Ω–∞ –ø–∞–º'—è—Ç—å:</strong> <span th:text="${phone.memorySize}"></span> –ì–ë</p>
                <br>
                <p><strong>–¶—ñ–Ω–∞:</strong>
                    <span id="priceDisplay" th:text="${#numbers.formatInteger(phone.price, 0, 'DEFAULT')}"></span> ‚Ç¥
<!--                    <input type="number" name="quantity" th:value="${order.quantity != null ? order.quantity : 1}"-->
<!--                           id="quantity" min="1" max="100" value="1" required>-->
<!--                    <input type="number"-->
<!--                           name="quantity"-->
<!--                           th:value="${order.quantity != null ? order.quantity : 1}"-->
<!--                           id="quantity"-->
<!--                           min="1"-->
<!--                           max="100"-->
<!--                           step="1"-->
<!--                           required-->
<!--                           onkeydown="return false;"> &lt;!&ndash; üîí –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤–≤–æ–¥ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã &ndash;&gt;-->
<!--                    <label for="quantity">—à—Ç.</label>-->
<!--                <div style="display: flex; align-items: center; gap: 10px;">-->
<!--                    <button type="button" onclick="changeQuantity(-1)">‚àí</button>-->
<!--                    <input type="number" id="quantity" name="quantity" value="1" min="1" max="100" readonly>-->
<!--                    <button type="button" onclick="changeQuantity(1)">+</button>-->
<!--                </div>-->

                <div class="quantity-control">
                    <button type="button" class="btn-qty" onclick="decreaseQty()">‚àí</button>
                    <input type="number" id="quantity" name="quantity"
                           min="1" max="100" value="1" required />
                    <button type="button" class="btn-qty" onclick="increaseQty()">+</button>
                </div>

                </p>
                <p><strong>–°—É–º–∞ –¥–æ —Å–ø–ª–∞—Ç–∏:</strong> <span id="totalPrice">0</span> ‚Ç¥</p>
            </div>
        </div>
        <hr style="width: 80%; margin: 0 auto; border: 1px solid grey;"/>
        <br>

        <div style="display: flex; flex-direction: column; align-items: flex-end; margin-right: 80px">
            <!-- –ü–æ–ª–µ –∏–º–µ–Ω–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π -->
            <div>
                <div th:if="${#fields.hasErrors('personName')}" th:errors="*{personName}"
                     style="color: red; font-size: 14px; margin-bottom: 5px; text-align: right;">
                    –ü–æ–º–∏–ª–∫–∞ —ñ–º–µ–Ω—ñ
                </div>
                <label for="personName" style="font-family: 'Grava Display', serif;">–Ü–º'—è –ø–æ–∫—É–ø—Ü—è:</label>
                <input style="border: 2px solid limegreen; border-radius: 5px; margin-bottom: 10px; padding: 5px;"
                       type="text"
                       th:field="*{personName}" id="personName" placeholder="–≤i–¥ 2 –¥–æ 20 –ª—ñ—Ç–µ—Ä" required>
            </div>
            <!-- –ü–æ–ª–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π -->
            <div>
                <div th:if="${#fields.hasErrors('personPhone')}" th:errors="*{personPhone}"
                     style="color: red; font-size: 14px; margin-bottom: 5px; text-align: right;">
                    –ü–æ–º–∏–ª–∫–∞ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω—É
                </div>
                <label for="personPhone" style="font-family: 'Grava Display', serif;">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:</label>
                <input style="border: 2px solid limegreen; border-radius: 5px; padding: 8px;" type="tel"
                       th:field="*{personPhone}" id="personPhone" placeholder="380XXXXXXXXX" required>
            </div>
        </div>

        <!-- –ü–æ–ª–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
        <div style="display: flex; margin-top: 7px; justify-content: flex-end;">
            <label for="personComment"></label><br>
            <div style="display: flex; align-items: flex-end; gap: 18px;">
                <div id="charCount" style="font-size: 14px; color: #777; white-space: nowrap;">0/150</div>
                <textarea id="personComment" th:field="*{personComment}" placeholder="–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä:"
                          maxlength="150" rows="3" cols="50" oninput="updateCharacterCount()"
                          style="text-align: left; vertical-align: top; resize: none; width: 70%; padding: 8px;
                      font-size: 16px; border-radius: 8px; border: 1px solid #ccc;"></textarea>
            </div>
        </div>

        <script>
            function updateCharacterCount() {
                let textArea = document.getElementById('personComment');
                let charCount = textArea.value.length;
                let maxLength = textArea.getAttribute('maxlength');
                document.getElementById('charCount').textContent = charCount + '/' + maxLength;
            }
        </script>

        <script>
            const phoneInput = document.getElementById('personPhone');
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            if (!phoneInput.value) {
                phoneInput.value = '380';
            }

            phoneInput.addEventListener('input', function () {
                if (!phoneInput.value.startsWith('380')) {
                    phoneInput.value = '380';
                }
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –¥–æ 12 —Å–∏–º–≤–æ–ª–æ–≤ (380 + 9 —Ü–∏—Ñ—Ä)
                if (phoneInput.value.length > 12) {
                    phoneInput.value = phoneInput.value.substring(0, 12);
                }
            });
        </script>

        <script>
            function increaseQty() {
                const input = document.getElementById('quantity');
                let current = parseInt(input.value) || 1;
                if (current < parseInt(input.max)) input.value = current + 1;
            }

            function decreaseQty() {
                const input = document.getElementById('quantity');
                let current = parseInt(input.value) || 1;
                if (current > parseInt(input.min)) input.value = current - 1;
            }
        </script>



        <br>
        <p>
            <label for="pickupPoint">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–æ—á–∫—É –≤–∏–¥–∞—á—ñ:</label>
            <select id="pickupPoint" th:field="*{point}" required>
                <option value="–ö–∏—ó–≤, –≤—É–ª. –ê–Ω—Ç–æ–Ω–æ–≤–∏—á–∞, 50">–ö–∏—ó–≤, –≤—É–ª. –ê–Ω—Ç–æ–Ω–æ–≤–∏—á–∞, 50 (10:00-21:00)</option>
                <option value="–î–Ω—ñ–ø—Ä–æ, –≤—É–ª. –ú–∞–≥–Ω—ñ—Ç–æ–≥–æ—Ä—Å—å–∫–∞, 1–ê">–î–Ω—ñ–ø—Ä–æ, –≤—É–ª. –ú–∞–≥–Ω—ñ—Ç–æ–≥–æ—Ä—Å—å–∫–∞, 1–ê (10:00-21:00)</option>
                <option value="–û–¥–µ—Å–∞, –≤—É–ª. –î–µ—Ä–∏–±–∞—Å—ñ–≤—Å—å–∫–∞ 3–î">–û–¥–µ—Å–∞, –≤—É–ª. –î–µ—Ä–∏–±–∞—Å—ñ–≤—Å—å–∫–∞ 3–î (09:00-22:00)</option>
            </select>
        </p>

        <div class="form-group">
            <button type="submit" class="btn-submit">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
        </div>
    </form>
</div>

<script>
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    const priceElement = document.getElementById('priceDisplay');
    const quantityInput = document.getElementById('quantity');
    const totalPriceElement = document.getElementById('totalPrice');

    const unitPrice = parseFloat(priceElement.innerText.replace(/\s/g, ''));

    function updateTotalPrice() {
        const quantity = parseInt(quantityInput.value) || 1;
        const total = unitPrice * quantity;
        totalPriceElement.innerText = total.toLocaleString('uk-UA');
        setTimeout(() => totalPriceElement.style.color = '#2e7d32', 500);
    }

    quantityInput.addEventListener('input', updateTotalPrice);
    window.addEventListener('DOMContentLoaded', updateTotalPrice);
</script>

</body>
<style>
</style>
</html>
